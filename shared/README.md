# Shared Components & Configuration

This directory contains shared code used by both the client intake system and the document generation system.

## Purpose

The shared resources ensure:
- **Single Source of Truth**: Database is the authoritative source for issue taxonomy
- **Visual Consistency**: Both forms look and behave identically
- **Reduced Duplication**: Common UI components and configs are reused
- **Type Safety**: TypeScript interfaces ensure correct data structures

## Directory Structure

```
shared/
├── config/
│   └── issue-categories-config.ts    # Auto-generated from database
├── components/
│   ├── IssueCheckboxGroup.tsx        # Reusable checkbox grid
│   ├── IssueCategorySection.tsx      # Complete category section
│   └── index.ts                       # Component exports
└── README.md                          # This file
```

## Configuration (`config/`)

### `issue-categories-config.ts`

**AUTO-GENERATED FILE** - This file is automatically generated from the database.

**DO NOT EDIT MANUALLY**

To update this file:
1. Add categories/options to database via migration
2. Run: `npm run generate:issue-config`
3. Commit the updated file

**Generated by:** `scripts/generate-issue-categories-config.js`
**Source:** Database tables (`issue_categories`, `issue_options`)
**Contents:** 30 categories, 157 options

## Components (`components/`)

### `IssueCheckboxGroup`

Renders a grid of checkboxes for issue options within a category.

**Props:**
- `categoryCode`: Category identifier (e.g., 'vermin', 'insects')
- `options`: Array of available options from config
- `selectedOptions`: Array of selected option IDs
- `onOptionChange`: Callback for checkbox changes
- `disabled`: Disable all checkboxes
- `className`: Additional CSS classes

**Features:**
- Responsive grid layout (3 columns → 2 → 1)
- Consistent checkbox styling
- Visual feedback for selected items
- Type-safe with generated config

**Usage:**
```tsx
import { IssueCheckboxGroup } from 'shared/components';
import { ISSUE_CATEGORIES } from 'shared/config/issue-categories-config';

const category = ISSUE_CATEGORIES.find(c => c.code === 'vermin');

<IssueCheckboxGroup
  categoryCode="vermin"
  options={category.options}
  selectedOptions={selectedOptionIds}
  onOptionChange={(optionId, checked) => {
    // Handle change
  }}
/>
```

### `IssueCategorySection`

Complete issue category section with master checkbox, options, and metadata fields.

**Props:**
- `category`: Full category object from config
- `hasIssue`: Whether this category has issues
- `onToggle`: Callback for master checkbox
- `selectedOptions`: Array of selected option IDs
- `onOptionChange`: Callback for option changes
- `showIntakeExtras`: Show intake-specific fields (details, dates, photos)
- `metadata`: Metadata values (details, dates, severity)
- `onMetadataChange`: Callback for metadata changes
- `defaultExpanded`: Initial expanded state
- `disabled`: Disable all inputs

**Features:**
- Master checkbox (has issue toggle)
- Expandable/collapsible sections
- Checkbox grid (uses `IssueCheckboxGroup`)
- Intake-specific metadata fields:
  - Details textarea
  - First noticed date
  - Severity level
  - Repair history
  - Photo upload display
- Smooth animations
- Accessibility support

**Usage (Intake Form):**
```tsx
import { IssueCategorySection } from 'shared/components';
import { ISSUE_CATEGORIES } from 'shared/config/issue-categories-config';

const category = ISSUE_CATEGORIES[0]; // Vermin

<IssueCategorySection
  category={category}
  hasIssue={categoryToggles[category.code]}
  onToggle={(hasIssue) => {
    setCategoryToggles(prev => ({ ...prev, [category.code]: hasIssue }));
  }}
  selectedOptions={selectedOptions[category.code] || []}
  onOptionChange={(optionId, checked) => {
    // Handle option change
  }}
  showIntakeExtras={true}
  metadata={metadata[category.code]}
  onMetadataChange={(field, value) => {
    // Handle metadata change
  }}
/>
```

**Usage (Doc Gen Form):**
```tsx
import { IssueCategorySection } from 'shared/components';
import { ISSUE_CATEGORIES } from 'shared/config/issue-categories-config';

const category = ISSUE_CATEGORIES[0];

<IssueCategorySection
  category={category}
  hasIssue={categoryToggles[category.code]}
  onToggle={(hasIssue) => {
    // Handle toggle
  }}
  selectedOptions={selectedOptions[category.code] || []}
  onOptionChange={(optionId, checked) => {
    // Handle option change
  }}
  showIntakeExtras={false}  // Doc gen doesn't need metadata
/>
```

## Development Workflow

### Adding New Issue Categories

1. **Create Migration**
   ```sql
   -- database/migrations/00X_add_new_category.sql
   INSERT INTO issue_categories (category_code, category_name, display_order, is_active)
   VALUES ('newCategory', 'New Category Name', 31, true);

   INSERT INTO issue_options (category_id, option_code, option_name, display_order, is_active)
   SELECT id, 'Option1', 'Option 1 Name', 1, true
   FROM issue_categories WHERE category_code = 'newCategory';
   ```

2. **Run Migration**
   ```bash
   psql $DATABASE_URL -f database/migrations/00X_add_new_category.sql
   ```

3. **Regenerate Config**
   ```bash
   npm run generate:issue-config
   ```

4. **Use in Forms**
   The new category automatically appears in `ISSUE_CATEGORIES` array.

### Styling Customization

The components use scoped CSS-in-JS (`styled-jsx`). To customize:

1. Override styles in your consuming component
2. Pass `className` prop for additional styles
3. Use CSS variables for theming (future enhancement)

### TypeScript Types

All types are exported for use in consuming code:

```tsx
import type {
  IssueOption,
  IssueCategory,
  IssueCheckboxGroupProps,
  IssueCategorySectionProps,
  IssueCategoryMetadata
} from 'shared/components';
```

## Implementation Status

**Phase 2.1 - Complete** ✅
- [x] Database query script created
- [x] TypeScript config auto-generation working
- [x] Config exported with 30 categories, 157 options

**Phase 2.2 - Complete** ✅
- [x] `IssueCheckboxGroup` component created
- [x] `IssueCategorySection` component created
- [x] Components documented
- [x] Type definitions complete

**Next Steps:**
- [ ] Phase 2.3: Visual testing and documentation
- [ ] Phase 3: Refactor intake form to use shared components
- [ ] Phase 4: Build "Load from Intake" feature

## Related Documentation

- [INTAKE_DOCGEN_UNIFICATION_PLAN_V2.md](../docs/client-intake/INTAKE_DOCGEN_UNIFICATION_PLAN_V2.md) - Full implementation plan
- [PHASE_1_COMPLETE_VERIFICATION.md](../database/reports/PHASE_1_COMPLETE_VERIFICATION.md) - Phase 1 verification

## Maintenance

### Regenerating Config

The config should be regenerated whenever:
- Database migrations add/modify categories or options
- Before major deployments
- When syncing development with production data

```bash
# Regenerate from local database
npm run generate:issue-config

# Verify output
cat shared/config/issue-categories-config.ts | head -100
```

### Testing Components

```bash
# Unit tests (future)
npm run test:unit -- shared/components

# Storybook (future)
npm run storybook
```

## Support

For questions or issues with shared components:
1. Check this README
2. Review the implementation plan
3. Examine component source code and inline documentation
4. Ask the development team
